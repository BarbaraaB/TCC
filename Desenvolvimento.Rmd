#Install Libs
```{r Libs, include=FALSE}
install.packages("syuzhet")
install.packages('pander')
install.packages("tidyverse")
install.packages("lubridate")
install.packages("wordcloud")
install.packages("tm")
library(syuzhet)
library(readr)
library(tidyverse)
library(lubridate)
library(wordcloud)
library(tm)
```

```{r Import Tweets, include=FALSE}
#Import entire database of tweets
cleaned_tweets <- read_csv("D:/Faculdade/TCC e IC/cleaned_tweets.csv")

#only part of the base, for testing
cleaned_tweets <- slice_sample(cleaned_tweets, n = 10000, replace = FALSE)

# # of lines
N <- length(cleaned_tweets$created_at)
```

```{r Frequency of Words}
# create corpus
corpus = Corpus(VectorSource(cleaned_tweets$full_text))
# create term-document matrix
tdm = TermDocumentMatrix(corpus)
# convert as matrix
tdm = as.matrix(tdm)

m <- as.matrix(tdm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
head(d, 300)
```

```{r Extract Sentiments, include=FALSE}
#extracts the feeling of every word from the tweet
sentiment <- get_nrc_sentiment(cleaned_tweets$full_text, language = "portuguese")
```

```{r formatting dataframe}
#dataframe of the tweet date + the extraction of emotions
sentiment_df <- bind_cols(cleaned_tweets[,"created_at"],sentiment)

#rename columns with portuguese words of sentiments
sentiment_df <- sentiment_df %>% 
  rename(
    raiva = anger,
    ansiedade = anticipation,
    nojo = disgust, 
    medo = fear,
    alegria = joy,
    tristeza = sadness, 
    surpresa = surprise, 
    esperanca = trust,
    negativo = negative, 
    positivo = positive
  )

#Just sentiments
#grouping the dataframe months together with the sum of emotions
sentiment_month <- sentiment_df %>% 
  group_by(mes = month(created_at, label = TRUE, abbr = TRUE)) %>% 
  summarise(across(.cols = raiva:esperanca, sum))

#database on longer format for chart
sentiment_month_longer <- pivot_longer(sentiment_month, raiva:esperanca)
 
#Just positive and negative
#grouping the dataframe months together with the sum of positive and negative
pos_neg_month <- sentiment_df %>% 
  group_by(mes = month(created_at, label = TRUE, abbr = TRUE)) %>% 
  summarise(across(.cols = negativo:positivo, sum))

#database on longer format for chart
pos_neg_month_longer <- pivot_longer(pos_neg_month, negativo:positivo)
```



```{r}
#line plot sentiment
ggplot(sentiment_month_longer) + 
  aes(x=mes, y=value, color = name, group=name) + 
  geom_line() + 
  geom_point()

#line plot positive and negative
ggplot(pos_neg_month_longer) + 
  aes(x=mes, y=value, color = name, group=name) + 
  geom_line() + 
  geom_point()

#Word cloud 
wordcloud(words = d$word, freq = d$freq, max.words = 200, random.order = FALSE, color = brewer.pal(11,"RdGy"))

#ggsave("D:/Faculdade/TCC e IC/Imagens/grafico_dispers.png", g)
```

